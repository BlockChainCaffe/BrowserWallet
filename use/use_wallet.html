<html>
  <body>
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
        <script charset="utf-8" src="../dist/ethers-v4.min.js" type="text/javascript"></script>
        <script type="text/javascript" src="../dist/FileSaver.js"></script>
        <script type="text/javascript" src="../dist/qrcode.js"></script>
        <script>

            // ---- GLOBALS ----------------------------------------------------------------------------------------
            var passOK = false;

            // Wallet parameters
            var wallet;
            var wpass;
            var seed;
            var addr;
            var priv;
            var json;
            var reader = new FileReader();

            // ---- FUNCTIONS --------------------------------------------------------------------------------------
            
            function creation_progress(p) {
                document.getElementById('out_creation').innerHTML = "Restoring Wallet : " + parseInt(p * 100) + "%";
            }

            function importJ() {
                wpass = document.getElementById('password').value;
                var file = document.getElementById('files').files[0];
                reader.readAsText(file, "UTF-8");
                reader.onload = function (evt) {
                    // read json
                    json = reader.result;
                    // get keystore from json
                    ethers.Wallet.fromEncryptedJson(json,wpass,creation_progress)
                        .then( (w) => {
                            wallet = w;
                            seed = wallet.mnemonic;
                            priv = wallet.privateKey;
                            addr = wallet.address;
                            document.getElementById('input').style.display="none";
                            // Show data
                            document.getElementById('out_address').innerHTML = "Address : " + addr;
                        })
                        .catch( reason => {
                            alert(reason);
                        });
                }
            }


        </script>

        <h1>Use Wallet from JSON</h1>
        <div id="input">
            <h2>Load Wallet</h2>
            Load your JSON wallet file :<br>
            <input type="file" id="files" name="files" width="80%"/> 
            <p></p>
            <div>
                Input your password here.<br>
                <input id="password" placeholder="Type your password here" size="80" type="text" />
                <div id="pwstrength">&nbsp;</div>
            </div>
            <p></p>
            <button id="btn_restore" onclick="importJ()">Restore wallet from Seed</button>    
            <div id="out_creation"></div>   
        </div>
        
        <hr>

        <div id="out_address"></div>

    </body>
</html>
